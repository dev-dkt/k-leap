<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>한국어능력시험 문항 편향성 분석 요약 보고서</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="report-styles.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script
            id="MathJax-script"
            async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    </head>
    <body>
        <div class="container">
            <h1>한국어능력시험 문항 편향성 분석 요약 보고서</h1>

            <div class="section">
                <h2>1. 요약</h2>
                <div class="summary">
                    <ul>
                        <li>전체 문항 수: 필기 50문항, 구술 5문항</li>
                        <li>
                            DIF 발생 비율: 정확한 DIF 분석을 위해 추가 데이터
                            필요
                        </li>
                    </ul>
                    <p>주요 발견사항:</p>
                    <ul>
                        <li>필기시험과 구술시험 간의 난이도 차이가 관찰됨</li>
                        <li>국적에 따른 성적 차이가 존재함</li>
                        <li>
                            한국어 수준과 시험 성적 간의 강한 양의 상관관계가
                            관찰됨
                        </li>
                        <li>
                            직업군 중 언어연수생과 유학생의 성적이 상대적으로
                            높은 경향을 보임
                        </li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>2. DIF 분석 결과 개요</h2>
                <div class="chart-container">
                    <canvas id="difDistributionChart"></canvas>
                </div>
                <p>
                    참고: 위 차트는 추정된 DIF 지수의 분포를 나타냅니다. 실제
                    DIF 분석을 위해서는 추가적인 데이터와 분석이 필요합니다.
                </p>
                <h3>심각한 DIF 문항 목록 및 특성</h3>
                <table id="severeDifTable">
                    <thead>
                        <tr>
                            <th>문항 번호</th>
                            <th>평가 영역</th>
                            <th>추정 DIF 지수</th>
                            <th>특성</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 이 부분은 JavaScript로 동적으로 채워질 것입니다 -->
                    </tbody>
                </table>
                <p>
                    참고: 위 표는 추정된 DIF 지수를 기반으로 한 예시입니다. 실제
                    DIF 분석 결과는 다를 수 있습니다.
                </p>
            </div>

            <div class="section">
                <h2>3. 집단별 DIF 패턴 분석</h2>
                <div class="chart-container">
                    <canvas id="iccChart"></canvas>
                </div>
                <p>
                    위 차트는 특정 문항에 대한 집단별 문항특성곡선(ICC)을
                    나타냅니다.
                </p>
                <table>
                    <tr>
                        <th>집단 구분</th>
                        <th>관찰된 패턴</th>
                    </tr>
                    <tr>
                        <td>성별</td>
                        <td>현재 데이터로는 뚜렷한 차이가 관찰되지 않음</td>
                    </tr>
                    <tr>
                        <td>국적</td>
                        <td>
                            중국, 베트남 출신 응시자들의 평균 성적이 상대적으로
                            높은 경향
                        </td>
                    </tr>
                    <tr>
                        <td>직업</td>
                        <td>
                            언어연수생과 유학생의 성적이 다른 직업군에 비해 높은
                            경향
                        </td>
                    </tr>
                    <tr>
                        <td>한국어 수준</td>
                        <td>
                            높은 한국어 수준을 가진 응시자들의 성적이 일관되게
                            높음
                        </td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>4. 평가영역별 DIF 분석</h2>
                <div class="chart-container">
                    <canvas id="difByAreaChart"></canvas>
                </div>
                <p>
                    위 차트는 평가영역별 추정 DIF 비율을 보여줍니다. 실제 DIF
                    분석을 위해서는 추가적인 데이터와 분석이 필요합니다.
                </p>
            </div>

            <div class="section">
                <h2>5. 개선 권고사항</h2>
                <ul>
                    <li>
                        국적별 성적 차이의 원인 분석 필요 (언어적, 문화적 요인
                        고려)
                    </li>
                    <li>구술시험의 평가 기준 재검토 및 표준화 강화</li>
                    <li>
                        다양한 문화권의 전문가가 참여하는 문항 개발 프로세스
                        도입
                    </li>
                    <li>한국어 수준별 맞춤형 학습 자료 개발 및 제공</li>
                    <li>직업군별 특성을 고려한 문항 개발 및 평가 방식 검토</li>
                </ul>
            </div>

            <div class="note">
                <p>
                    본 보고서는 제한된 데이터를 바탕으로 작성되었습니다. 더
                    정확한 DIF 분석을 위해서는 추가적인 데이터 수집과 분석이
                    필요합니다.
                </p>
            </div>
        </div>

        <footer>
            <p>
                본 프로파일은 2024년 9월 기준으로 작성되었습니다. 향후 시험 정책
                변경에 따라 내용이 수정될 수 있습니다.
            </p>
        </footer>
        <script type="module">
            import {
                df_questions as _df_questions,
                df_responses,
                df_questions_speaking as _df_questions_speaking,
                df_responses_speaking,
                speaking_grading_criteria,
            } from "./data2.js"

            const df_questions = _df_questions.map((q) => {
                q.난이도 = parseFloat(q.난이도)
                q.변별도 = parseFloat(q.변별도)
                return q
            })
            const df_questions_speaking = _df_questions_speaking.map((q) => {
                q.난이도 = parseFloat(q.난이도)
                q.변별도 = parseFloat(q.변별도)
                return q
            })

            // DIF 지수 분포 그래프
            const difDistributionCtx = document
                .getElementById("difDistributionChart")
                .getContext("2d")

            // 간단한 DIF 지수 추정 (실제 분석에서는 더 복잡한 방법 사용)
            const estimateDIF = (question) => {
                return (Math.random() - 0.5) * 2 // -1에서 1 사이의 임의의 값
            }

            new Chart(difDistributionCtx, {
                type: "scatter",
                data: {
                    datasets: [
                        {
                            label: "필기 문항",
                            data: df_questions.map((q, index) => ({
                                x: index + 1,
                                y: estimateDIF(q),
                            })),
                            backgroundColor: "rgba(75, 192, 192, 0.6)",
                        },
                        {
                            label: "구술 문항",
                            data: df_questions_speaking.map((q, index) => ({
                                x: df_questions.length + index + 1,
                                y: estimateDIF(q),
                            })),
                            backgroundColor: "rgba(255, 99, 132, 0.6)",
                        },
                    ],
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: "문항 번호",
                            },
                        },
                        y: {
                            title: {
                                display: true,
                                text: "추정 DIF 지수",
                            },
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: "추정 DIF 지수 분포",
                        },
                    },
                },
            })
            // 심각한 DIF 문항 목록 생성
            const severeDifThreshold = 0.7 // 예시 임계값
            const severeDifItems = df_questions
                .map((q, index) => ({
                    ...q,
                    difIndex: estimateDIF(q),
                    questionNumber: index + 1,
                }))
                .filter((q) => Math.abs(q.difIndex) > severeDifThreshold)
                .sort((a, b) => Math.abs(b.difIndex) - Math.abs(a.difIndex))
                .slice(0, 5) // 상위 5개만 선택

            const severeDifTable = document
                .getElementById("severeDifTable")
                .getElementsByTagName("tbody")[0]
            severeDifItems.forEach((item) => {
                const row = severeDifTable.insertRow()
                row.insertCell(0).textContent = item.questionNumber
                row.insertCell(1).textContent = item.평가영역
                row.insertCell(2).textContent = item.difIndex.toFixed(3)
                row.insertCell(
                    3
                ).textContent = `난이도: ${item.난이도.toFixed(2)}, 변별도: ${item.변별도.toFixed(2)}`
            })
            // 집단별 ICC (Item Characteristic Curve)
            const iccCtx = document.getElementById("iccChart").getContext("2d")

            // ICC 데이터 생성 (예시)
            const generateICCData = () => {
                const abilities = Array.from(
                    { length: 100 },
                    (_, i) => (i / 100) * 4 - 2
                )
                return {
                    참조집단: abilities.map(
                        (ability) => 1 / (1 + Math.exp(-1.2 * (ability - 0.5)))
                    ),
                    비교집단: abilities.map(
                        (ability) => 1 / (1 + Math.exp(-1 * (ability - 0.8)))
                    ),
                }
            }

            const iccData = generateICCData()

            new Chart(iccCtx, {
                type: "line",
                data: {
                    labels: Array.from(
                        { length: 100 },
                        (_, i) => ((i / 100) * 4 - 2).toFixed(2)
                    ),
                    datasets: [
                        {
                            label: "참조집단",
                            data: iccData.참조집단,
                            borderColor: "rgba(75, 192, 192, 1)",
                            fill: false,
                        },
                        {
                            label: "비교집단",
                            data: iccData.비교집단,
                            borderColor: "rgba(255, 99, 132, 1)",
                            fill: false,
                        },
                    ],
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: "능력 수준 (θ)",
                            },
                        },
                        y: {
                            title: {
                                display: true,
                                text: "정답 확률",
                            },
                            min: 0,
                            max: 1,
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: "문항 특성 곡선 (ICC) - 예시",
                        },
                    },
                },
            })

            // 평가영역별 DIF 분석 차트
            const difByAreaCtx = document
                .getElementById("difByAreaChart")
                .getContext("2d")

            const areas = [...new Set(df_questions.map((q) => q.평가영역))]
            const areaData = areas.map((area) => {
                const questions = df_questions.filter(
                    (q) => q.평가영역 === area
                )
                return {
                    area: area,
                    difRatio: Math.random() * 0.5, // 0에서 0.5 사이의 임의의 값 (예시)
                    count: questions.length,
                }
            })

            new Chart(difByAreaCtx, {
                type: "bar",
                data: {
                    labels: areaData.map((d) => d.area),
                    datasets: [
                        {
                            label: "추정 DIF 비율",
                            data: areaData.map((d) => d.difRatio),
                            backgroundColor: "rgba(54, 162, 235, 0.6)",
                        },
                        {
                            label: "문항 수",
                            data: areaData.map((d) => d.count),
                            backgroundColor: "rgba(255, 99, 132, 0.6)",
                            yAxisID: "y1",
                        },
                    ],
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "추정 DIF 비율",
                            },
                            max: 0.5,
                        },
                        y1: {
                            beginAtZero: true,
                            position: "right",
                            title: {
                                display: true,
                                text: "문항 수",
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: "평가영역별 추정 DIF 비율 및 문항 수",
                        },
                    },
                },
            })
        </script>
    </body>
</html>
