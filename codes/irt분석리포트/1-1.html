<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>한국어능력시험 문항 파라미터 분석 요약 보고서</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./report-styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>한국어능력시험 문항 파라미터 분석 요약 보고서</h1>

      <div class="section">
        <table>
          <tr>
            <th>시험일</th>
            <td>2024년 9월 27일</td>
          </tr>
          <tr>
            <th>시험 유형</th>
            <td>사전평가</td>
          </tr>
          <tr>
            <th>시험장</th>
            <td>CBT평가센터</td>
          </tr>
          <tr>
            <th>시행 회차</th>
            <td>100회차</td>
          </tr>
        </table>
      </div>

      <div class="section">
        <h2>1. 분석 결과 요약</h2>
        <h3>시험 통계</h3>
        <ul>
          <li>총 응시자 수: 30명</li>
          <li>필답형 평가 문항 수: 50문항</li>
          <li>구술형 평가 문항 수: 5문항</li>
          <li>필답형 평가 평균 점수: 33.07점 (100점 만점 기준)</li>
          <li>구술형 평가 평균 점수: 8.33점 (25점 만점 기준)</li>
          <li>필답형 평가 합격률: 10% (64점 이상 기준)</li>
        </ul>

        <h3>주요 분석 결과</h3>
        <ul>
          <li>
            필답형 평가 문항 난이도 분포:
            <ul>
              <li>저난도(-3.0 ~ -1.0) 11문항</li>
              <li>중난도(-1.0 ~ 1.0) 35문항</li>
              <li>고난도(1.0 ~ 3.0) 4문항</li>
            </ul>
          </li>
          <li>
            6개 필답형 평가 문항(11, 16, 24, 37, 43, 45번)에서 고변별도(>1.0)가
            관찰되었습니다.
          </li>
          <li>
            평가영역별 필답형 문항 구성:
            <ul>
              <li>어휘 14문항</li>
              <li>문법 14문항</li>
              <li>쓰기 5문항</li>
              <li>읽기 5문항</li>
              <li>문화 12문항</li>
            </ul>
          </li>
          <li>구술형 평가 문항은 모두 높은 변별도(>0.6)를 나타냈습니다.</li>
        </ul>
      </div>

      <div class="section">
        <h2>2. 필답형 평가 문항 파라미터 분석</h2>
        <div class="chart-grid">
          <div class="chart-container">
            <canvas id="difficultyChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="discriminationChart"></canvas>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>3. 구술형 평가 문항 파라미터 분석</h2>
        <div class="chart-grid">
          <div class="chart-container">
            <canvas id="oralDifficultyChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="oralDiscriminationChart"></canvas>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>4. 고변별도 문항 분석</h2>
        <h3>필답형 평가</h3>
        <ul>
          <li>고변별도 문항 기준: 변별도 > 1.0</li>
          <li>해당 문항: 11, 16, 24, 37, 43, 45번</li>
        </ul>
        <h3>구술형 평가</h3>
        <ul>
          <li>모든 문항이 높은 변별도를 보임 (변별도 > 0.6)</li>
        </ul>
      </div>

      <div class="section">
        <h2>5. 개선 제언</h2>
        <ol>
          <li>
            필답형 평가의 난이도 분포의 적절성을 검토하고, 필요시 난이도 조정을
            고려하십시오.
          </li>
          <li>
            필답형 평가에서 저변별도(< 0.3) 문항을 식별하고 개선 방안을
            모색하십시오.
          </li>
          <li>
            고변별도 문항의 특성을 분석하여 향후 문항 개발에 참고하십시오.
          </li>
          <li>
            평가영역별 문항 수의 균형을 재검토하고, 필요시 조정을 고려하십시오.
          </li>
          <li>
            필답형 평가와 구술형 평가 간의 난이도 균형을 검토하고, 필요시
            조정하십시오.
          </li>
          <li>
            낮은 합격률을 고려하여 전반적인 시험 난이도의 적절성을 평가하십시오.
          </li>
        </ol>

        <p>
          이러한 개선을 통해 한국어능력시험의 신뢰도와 타당도를 높이고, 응시자의
          언어 능력을 더욱 정확하게 평가할 수 있을 것으로 기대됩니다.
        </p>
      </div>
    </div>

    <footer>
      <p>
        본 가이드라인은 2024년 9월 기준으로 작성되었습니다. 향후 시험 정책
        변경에 따라 내용이 수정될 수 있습니다.
      </p>
    </footer>

    <script type="module">
      import {
        df_questions,
        df_responses,
        df_questions_speaking,
        df_responses_speaking,
      } from "./data2.js";

      // 필답형 평가 데이터 처리
      function processWrittenData(questions, responses) {
        const totalQuestions = questions.length;
        const totalResponses = responses.length;
        let totalScore = 0;
        let passCount = 0;

        responses.forEach((r) => {
          const score = parseInt(r.점수);
          totalScore += score;
          if (score >= 64) passCount++;
        });

        const averageScore = totalScore / totalResponses;
        const passRate = (passCount / totalResponses) * 100;

        const difficultyData = questions.map((q) => ({
          number: q.문제번호,
          difficulty: parseFloat(q.난이도),
          discrimination: parseFloat(q.변별도),
          area: q.평가영역,
        }));

        const areaCount = difficultyData.reduce((acc, curr) => {
          acc[curr.area] = (acc[curr.area] || 0) + 1;
          return acc;
        }, {});

        return {
          totalQuestions,
          totalResponses,
          averageScore,
          passRate,
          difficultyData,
          areaCount,
        };
      }

      // 구술형 평가 데이터 처리
      function processOralData(questions, responses) {
        const totalQuestions = questions.length;
        const totalResponses = responses.length;
        let totalScore = 0;

        responses.forEach((r) => {
          totalScore += parseInt(r.점수);
        });

        const averageScore = totalScore / totalResponses;

        const difficultyData = questions.map((q) => ({
          number: q.문제번호,
          difficulty: parseFloat(q.난이도),
          discrimination: parseFloat(q.변별도),
        }));

        return {
          totalQuestions,
          totalResponses,
          averageScore,
          difficultyData,
        };
      }

      // 차트 옵션
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "top",
          },
        },
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      };

      // 차트 생성 함수
      function createChart(ctx, data, options) {
        return new Chart(ctx, {
          type: "bar",
          data: data,
          options: options,
        });
      }

      window.onload = function () {
        const writtenData = processWrittenData(df_questions, df_responses);
        const oralData = processOralData(
          df_questions_speaking,
          df_responses_speaking
        );

        // 특정 텍스트를 포함하는 li 요소를 찾는 함수
        function findListItem(text) {
          const items = document.querySelectorAll("li");
          for (let item of items) {
            if (item.textContent.includes(text)) {
              return item;
            }
          }
          return null;
        }

        // 통계 정보 업데이트
        findListItem(
          "총 응시자 수"
        ).textContent = `총 응시자 수: ${writtenData.totalResponses}명`;
        findListItem(
          "필답형 평가 문항 수"
        ).textContent = `필답형 평가 문항 수: ${writtenData.totalQuestions}문항`;
        findListItem(
          "구술형 평가 문항 수"
        ).textContent = `구술형 평가 문항 수: ${oralData.totalQuestions}문항`;
        findListItem(
          "필답형 평가 평균 점수"
        ).textContent = `필답형 평가 평균 점수: ${writtenData.averageScore.toFixed(
          2
        )}점 (100점 만점 기준)`;
        findListItem(
          "구술형 평가 평균 점수"
        ).textContent = `구술형 평가 평균 점수: ${oralData.averageScore.toFixed(
          2
        )}점 (25점 만점 기준)`;
        findListItem(
          "필답형 평가 합격률"
        ).textContent = `필답형 평가 합격률: ${writtenData.passRate.toFixed(
          2
        )}% (64점 이상 기준)`;

        // 난이도 분포 업데이트
        const difficultyDistribution = writtenData.difficultyData.reduce(
          (acc, curr) => {
            if (curr.difficulty < -1) acc.low++;
            else if (curr.difficulty > 1) acc.high++;
            else acc.medium++;
            return acc;
          },
          { low: 0, medium: 0, high: 0 }
        );

        const difficultyList =
          findListItem("필답형 평가 문항 난이도 분포").querySelector("ul");
        difficultyList.innerHTML = `
    <li>저난도(-3.0 ~ -1.0) ${difficultyDistribution.low}문항</li>
    <li>중난도(-1.0 ~ 1.0) ${difficultyDistribution.medium}문항</li>
    <li>고난도(1.0 ~ 3.0) ${difficultyDistribution.high}문항</li>
  `;

        // 고변별도 문항 업데이트
        const highDiscriminationItems = writtenData.difficultyData
          .filter((item) => item.discrimination > 1.0)
          .map((item) => item.number)
          .join(", ");
        findListItem(
          "해당 문항:"
        ).textContent = `해당 문항: ${highDiscriminationItems}`;

        // 평가영역별 문항 구성 업데이트
        const areaList =
          findListItem("평가영역별 필답형 문항 구성").querySelector("ul");
        areaList.innerHTML = Object.entries(writtenData.areaCount)
          .map(([area, count]) => `<li>${area} ${count}문항</li>`)
          .join("");

        // 차트 생성
        createChart(
          document.getElementById("difficultyChart").getContext("2d"),
          {
            labels: writtenData.difficultyData.map((d) => d.number),
            datasets: [
              {
                label: "필기시험 난이도",
                data: writtenData.difficultyData.map((d) => d.difficulty),
                backgroundColor: "rgba(52, 152, 219, 0.6)",
                borderColor: "rgba(52, 152, 219, 1)",
                borderWidth: 1,
              },
            ],
          },
          {
            ...chartOptions,
            plugins: {
              ...chartOptions.plugins,
              title: { display: true, text: "필기시험 난이도 분포" },
            },
          }
        );

        createChart(
          document.getElementById("discriminationChart").getContext("2d"),
          {
            labels: writtenData.difficultyData.map((d) => d.number),
            datasets: [
              {
                label: "필기시험 변별도",
                data: writtenData.difficultyData.map((d) => d.discrimination),
                backgroundColor: "rgba(46, 204, 113, 0.6)",
                borderColor: "rgba(46, 204, 113, 1)",
                borderWidth: 1,
              },
            ],
          },
          {
            ...chartOptions,
            plugins: {
              ...chartOptions.plugins,
              title: { display: true, text: "필기시험 변별도" },
            },
          }
        );

        createChart(
          document.getElementById("oralDifficultyChart").getContext("2d"),
          {
            labels: oralData.difficultyData.map((d) => d.number),
            datasets: [
              {
                label: "구술시험 난이도",
                data: oralData.difficultyData.map((d) => d.difficulty),
                backgroundColor: "rgba(231, 76, 60, 0.6)",
                borderColor: "rgba(231, 76, 60, 1)",
                borderWidth: 1,
              },
            ],
          },
          {
            ...chartOptions,
            plugins: {
              ...chartOptions.plugins,
              title: { display: true, text: "구술시험 난이도" },
            },
          }
        );

        createChart(
          document.getElementById("oralDiscriminationChart").getContext("2d"),
          {
            labels: oralData.difficultyData.map((d) => d.number),
            datasets: [
              {
                label: "구술시험 변별도",
                data: oralData.difficultyData.map((d) => d.discrimination),
                backgroundColor: "rgba(241, 196, 15, 0.6)",
                borderColor: "rgba(241, 196, 15, 1)",
                borderWidth: 1,
              },
            ],
          },
          {
            ...chartOptions,
            plugins: {
              ...chartOptions.plugins,
              title: { display: true, text: "구술시험 변별도" },
            },
          }
        );
      };
    </script>
  </body>
</html>
