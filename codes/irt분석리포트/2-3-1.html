<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>한국어능력시험 개인 능력 프로파일</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="report-styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <style>
      .info-box,
      .feedback-box,
      .faq {
        background-color: #e9f7fe;
        padding: 15px;
        border-radius: 5px;
        margin-top: 15px;
        border-left: 5px solid #3498db;
      }
      .chart-container {
        position: relative;
        margin: auto;
        height: 300px;
        width: 100%;
      }
      .skill-meter {
        background-color: #e0e0e0;
        border-radius: 10px;
        height: 20px;
        margin-bottom: 10px;
      }
      .skill-meter-fill {
        background-color: #3498db;
        height: 100%;
        border-radius: 10px;
        transition: width 1s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>한국어능력시험 개인 능력 프로파일</h1>

      <div class="section">
        <h2>1. 개인 정보</h2>
        <table>
          <tr>
            <th>이름</th>
            <td id="examinee-name"></td>
          </tr>
          <tr>
            <th>수험 번호</th>
            <td id="examinee-id"></td>
          </tr>
          <tr>
            <th>시험 일자</th>
            <td>2024년 9월 29일</td>
          </tr>
        </table>
      </div>

      <div class="section">
        <h2>2. 종합 능력 평가</h2>
        <div class="chart-container">
          <canvas id="overall-ability-chart"></canvas>
        </div>
        <p>전체 능력 추정치: <strong id="overall-ability"></strong></p>
        <p>백분위 점수: <strong id="percentile"></strong></p>
        <p>95% 신뢰구간: <strong id="confidence-interval"></strong></p>
        <div class="info-box">
          <h3>용어 설명</h3>
          <p>
            <strong>능력 추정치(θ):</strong> 당신의 전반적인 한국어 능력을
            나타내는 점수입니다. -3에서 3 사이의 값을 가지며, 높을수록 더 뛰어난
            능력을 의미합니다.
          </p>
          <p>
            <strong>백분위 점수:</strong> 다른 수험자들과 비교했을 때 당신의
            상대적 위치를 나타냅니다. 예를 들어, 80%라면 당신보다 낮은 점수를
            받은 사람이 80%라는 의미입니다.
          </p>
          <p>
            <strong>신뢰구간:</strong> 실제 능력이 이 범위 내에 있을 확률이
            95%임을 의미합니다. 이는 시험 결과의 정확성을 나타내는 지표입니다.
          </p>
        </div>
      </div>

      <div class="section">
        <h2>3. 영역별 능력 프로파일</h2>
        <div class="chart-container">
          <canvas id="skills-chart"></canvas>
        </div>
        <h3>영역별 강점과 약점 분석</h3>
        <div id="strength-weakness"></div>
        <div class="feedback-box">
          <h3>개인화된 피드백</h3>
          <p id="speaking-feedback"></p>
          <p id="listening-feedback"></p>
          <p id="reading-feedback"></p>
          <p id="writing-feedback"></p>
        </div>
      </div>

      <div class="section">
        <h2>4. 성장 트래커</h2>
        <div class="chart-container">
          <canvas id="growth-chart"></canvas>
        </div>
        <div id="growth-tracker"></div>
        <p>
          이전 시험 결과와 비교한 당신의 성장을 보여줍니다. 지속적인 학습의
          성과를 확인하세요!
        </p>
      </div>

      <div class="section">
        <h2>5. 향후 학습 제안</h2>
        <ul id="learning-suggestions"></ul>
      </div>

      <div class="section">
        <h2>6. 목표 설정</h2>
        <div id="goal-setting">
          <h3>다음 시험을 위한 목표</h3>
          <p>현재 능력을 기반으로 한 실현 가능한 목표를 설정해보세요:</p>
          <div id="goal-meters"></div>
          <p>
            이 목표들은 당신의 현재 능력에 5-10% 향상을 더한 값입니다. 꾸준한
            학습으로 달성해보세요!
          </p>
        </div>
      </div>

      <div class="section">
        <h2>7. 자주 묻는 질문 (FAQ)</h2>
        <div class="faq">
          <h3>Q: 이 보고서를 어떻게 해석해야 하나요?</h3>
          <p>
            A: 이 보고서는 당신의 한국어 능력을 종합적으로 평가합니다. 전체 능력
            추정치, 영역별 강점과 약점, 다른 수험자와의 비교 등을 통해 당신의
            현재 수준을 파악할 수 있습니다.
          </p>

          <h3>Q: 제 점수를 어떻게 활용할 수 있나요?</h3>
          <p>
            A: 이 점수는 취업, 유학, 또는 개인적인 성장 목표 설정에 활용할 수
            있습니다. 많은 기업과 교육기관에서 TOPIK 점수를 한국어 능력의
            객관적인 지표로 인정합니다.
          </p>

          <h3>Q: 다음 단계로 무엇을 해야 하나요?</h3>
          <p>
            A: 보고서에서 제안하는 학습 방법을 참고하여 약점을 보완하고, 강점을
            더욱 발전시키세요. 정기적으로 한국어를 사용하는 환경에 노출되는 것도
            중요합니다.
          </p>
        </div>
      </div>
    </div>

    <footer>
      <p>
        본 프로파일은 2024년 9월 기준으로 작성되었습니다. 향후 시험 정책 변경에
        따라 내용이 수정될 수 있습니다.
      </p>
    </footer>

    <script type="module">
      import {
        df_questions,
        df_responses,
        df_questions_speaking,
        df_responses_speaking,
        speaking_grading_criteria,
      } from "./data2.js";

      // 첫 번째 응시자의 데이터 선택
      const examinee = df_responses[0];
      const examineeSpeaking = df_responses_speaking[0];

      // 개인 정보 업데이트
      document.getElementById("examinee-name").textContent = examinee.이름;
      document.getElementById("examinee-id").textContent =
        examinee.외국인등록번호;

      // 종합 능력 평가 업데이트
      const overallAbility = parseFloat(examinee["능력 추정치 (theta)"]);
      document.getElementById("overall-ability").textContent =
        overallAbility.toFixed(2);

      // 백분위 점수 계산
      const allAbilities = df_responses.map((r) =>
        parseFloat(r["능력 추정치 (theta)"])
      );
      const percentile = (
        (allAbilities.filter((a) => a <= overallAbility).length /
          allAbilities.length) *
        100
      ).toFixed(2);
      document.getElementById("percentile").textContent = `${percentile}%`;

      // 신뢰구간 계산 (SE를 0.3으로 가정)
      const SE = 0.3;
      const CI_lower = (overallAbility - 1.96 * SE).toFixed(2);
      const CI_upper = (overallAbility + 1.96 * SE).toFixed(2);
      document.getElementById(
        "confidence-interval"
      ).textContent = `${CI_lower} ~ ${CI_upper}`;

      // 전체 능력 차트 (도넛 차트로 대체)
      function createOverallAbilityChart(ability) {
        const ctx = document
          .getElementById("overall-ability-chart")
          .getContext("2d");
        const normalizedAbility = (ability + 3) / 6; // -3 to 3 범위를 0 to 1 범위로 정규화
        new Chart(ctx, {
          type: "doughnut",
          data: {
            datasets: [
              {
                data: [normalizedAbility, 1 - normalizedAbility],
                backgroundColor: ["#36A2EB", "#E0E0E0"],
                borderWidth: 0,
              },
            ],
          },
          options: {
            cutout: "80%",
            rotation: -90,
            circumference: 180,
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: { enabled: false },
              legend: { display: false },
              annotation: {
                annotations: {
                  centerTextAnnotation: {
                    type: "label",
                    content: ability.toFixed(2),
                    color: "#333",
                    font: {
                      size: 24,
                      weight: "bold",
                    },
                    position: {
                      x: "50%",
                      y: "65%",
                    },
                  },
                },
              },
            },
          },
        });
      }

      createOverallAbilityChart(overallAbility);

      // 영역별 능력 데이터 준비
      const speakingAbility = parseFloat(
        examineeSpeaking["능력 추정치 (theta)"]
      );
      const listeningAbility = overallAbility + 0.2; // 예시 값, 실제 데이터로 대체 필요
      const readingAbility = overallAbility - 0.1; // 예시 값, 실제 데이터로 대체 필요
      const writingAbility = overallAbility + 0.3; // 예시 값, 실제 데이터로 대체 필요

      // 영역별 능력 차트
      function createSkillsChart(skills) {
        const ctx = document.getElementById("skills-chart").getContext("2d");
        new Chart(ctx, {
          type: "radar",
          data: {
            labels: Object.keys(skills),
            datasets: [
              {
                label: "현재 능력",
                data: Object.values(skills),
                fill: true,
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgb(54, 162, 235)",
                pointBackgroundColor: "rgb(54, 162, 235)",
                pointBorderColor: "#fff",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: "rgb(54, 162, 235)",
              },
            ],
          },
          options: {
            elements: {
              line: {
                borderWidth: 3,
              },
            },
            scales: {
              r: {
                angleLines: {
                  display: false,
                },
                suggestedMin: -3,
                suggestedMax: 3,
              },
            },
          },
        });
      }

      const abilities = {
        말하기: speakingAbility,
        듣기: listeningAbility,
        읽기: readingAbility,
        쓰기: writingAbility,
      };

      createSkillsChart(abilities);

      // 영역별 강점과 약점 분석
      function createStrengthWeaknessAnalysis(abilities, overallAbility) {
        const strengthWeaknessList =
          document.getElementById("strength-weakness");
        Object.entries(abilities).forEach(([skill, ability]) => {
          const skillMeter = document.createElement("div");
          skillMeter.className = "skill-meter";
          const skillMeterFill = document.createElement("div");
          skillMeterFill.className = "skill-meter-fill";
          skillMeterFill.style.width = `${((ability + 3) / 6) * 100}%`;
          skillMeter.appendChild(skillMeterFill);

          const skillLabel = document.createElement("p");
          skillLabel.textContent = `${skill}: ${
            ability > overallAbility ? "강점" : "약점"
          } (${ability.toFixed(2)})`;

          strengthWeaknessList.appendChild(skillLabel);
          strengthWeaknessList.appendChild(skillMeter);

          // 개인화된 피드백 생성
          const feedbackElement = document.getElementById(
            `${skill.toLowerCase()}-feedback`
          );
          let feedback = `${skill} 영역에서 당신은 `;
          if (ability > 2) {
            feedback +=
              "매우 뛰어난 실력을 보여주셨습니다. 고급 수준의 학습 자료로 더욱 발전시켜 보세요.";
          } else if (ability > 1) {
            feedback +=
              "좋은 실력을 보여주셨습니다. 다양한 상황에서의 연습을 통해 실력을 더욱 향상시킬 수 있습니다.";
          } else if (ability > 0) {
            feedback +=
              "평균 이상의 실력을 보여주셨습니다. 기본기를 다지고 조금 더 도전적인 학습을 시도해보세요.";
          } else {
            feedback +=
              "개선의 여지가 있습니다. 기초부터 차근차근 학습해 나가는 것이 좋겠습니다.";
          }
          feedbackElement.textContent = feedback;
        });
      }

      createStrengthWeaknessAnalysis(abilities, overallAbility);

      // 학습 제안 및 목표 설정 함수
      function createLearningPlanAndGoals(abilities) {
        const learningPlanList = document.getElementById(
          "learning-suggestions"
        );
        const goalSetting = document.getElementById("goal-setting");

        Object.entries(abilities).forEach(([skill, ability]) => {
          // 학습 제안
          const li = document.createElement("li");
          let suggestion = `${skill} 향상을 위해 `;
          switch (skill) {
            case "말하기":
              suggestion +=
                "매일 10분씩 한국어로 자기 소개를 연습해보세요. 또한, 한국어 회화 그룹에 참여하는 것도 좋은 방법입니다.";
              break;
            case "듣기":
              suggestion +=
                "한국 드라마나 뉴스를 자주 시청하며 듣기 능력을 향상시키세요. 팟캐스트도 좋은 학습 도구가 될 수 있습니다.";
              break;
            case "읽기":
              suggestion +=
                "매일 짧은 한국어 기사나 블로그 포스트를 읽어보세요. 점차 난이도를 높여가며 읽기 능력을 향상시킬 수 있습니다.";
              break;
            case "쓰기":
              suggestion +=
                "매일 한국어로 짧은 일기를 작성해보세요. 문법과 어휘 사용에 주의를 기울이며 쓰기 연습을 하면 효과적입니다.";
              break;
          }
          li.textContent = suggestion;
          learningPlanList.appendChild(li);

          // 목표 설정
          const goal = ability * 1.1; // 10% 향상을 목표로 설정
          const p = document.createElement("p");
          p.textContent = `${skill} 목표: ${goal.toFixed(2)}`;
          goalSetting.appendChild(p);
        });
      }

      createLearningPlanAndGoals(abilities);
    </script>
  </body>
</html>
