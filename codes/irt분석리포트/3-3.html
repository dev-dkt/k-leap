<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>한국어능력시험 문항 정보 분석 및 개선 가이드</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="report-styles.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>

        <style>
            #infoScatter3D {
                width: 100%; /* 차트의 너비 */
                height: 400px; /* 차트의 높이 */
                border: 1px solid #ccc;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>한국어능력시험 문항 정보 분석 및 개선 가이드</h1>

            <div class="section">
                <h2>1. 문항 정보 함수 개요</h2>
                <h3>1.1 정보 함수의 의미와 중요성</h3>
                <p>
                    문항 정보 함수는 특정 능력 수준에서 해당 문항이 제공하는
                    정보의 양을 나타냅니다. 높은 정보량은 문항의 정확성과
                    효율성을 의미합니다.
                </p>

                <h3>1.2 정보량과 문항 특성의 관계</h3>
                <ul>
                    <li>변별도가 높을수록 최대 정보량이 증가합니다.</li>
                    <li>
                        난이도는 최대 정보를 제공하는 능력 수준과 일치합니다.
                    </li>
                    <li>
                        정보 함수의 폭은 문항이 효과적으로 측정하는 능력 범위를
                        나타냅니다.
                    </li>
                </ul>
            </div>

            <div class="section">
                <h2>2. 현행 문항 정보량 분석</h2>
                <h3>2.1 문항별 최대 정보량 및 해당 능력 수준</h3>
                <div class="chart-container">
                    <canvas id="itemInfoScatter"></canvas>
                </div>

                <h3>2.2 평가영역별, 문항유형별 평균 정보량 비교</h3>
                <div class="chart-container">
                    <canvas id="avgInfoByCategory"></canvas>
                </div>
            </div>

            <div class="section">
                <h2>3. 고정보량 문항 특성 분석</h2>
                <ul id="highInfoCharacteristics">
                    <li>변별도가 1.0 이상으로 매우 높습니다.</li>
                    <li>
                        난이도가 -0.3에서 0.3 사이에 분포하여 중간 수준의 능력을
                        정확히 측정합니다.
                    </li>
                    <li>
                        문법과 문화 영역의 문항이 상대적으로 높은 정보량을
                        제공합니다.
                    </li>
                </ul>

                <h3>3.1 상위 10개 문항의 공통점</h3>
                <table id="topQuestionsTable">
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>문항 번호</th>
                            <th>최대 정보량</th>
                            <th>변별도</th>
                            <th>난이도</th>
                            <th>평가영역</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 상위 문항 데이터 삽입 -->
                    </tbody>
                </table>

                <h3>3.2 모범 사례 분석</h3>
                <ul>
                    <li>변별도가 1.0 이상으로 매우 높습니다.</li>
                    <li>
                        난이도가 -0.3에서 0.3 사이에 분포하여 중간 수준의 능력을
                        정확히 측정합니다.
                    </li>
                    <li>
                        문법과 문화 영역의 문항이 상대적으로 높은 정보량을
                        제공합니다.
                    </li>
                </ul>
            </div>

            <div class="section">
                <h2>4. 저정보량 문항 개선 방안</h2>
                <ul id="lowInfoImprovement">
                    <li>변별도가 1.0 이상으로 매우 높습니다.</li>
                    <li>
                        난이도가 -0.3에서 0.3 사이에 분포하여 중간 수준의 능력을
                        정확히 측정합니다.
                    </li>
                    <li>
                        문법과 문화 영역의 문항이 상대적으로 높은 정보량을
                        제공합니다.
                    </li>
                </ul>
                <h3>4.1 하위 10% 문항의 특성 분석</h3>
                <table id="bottomQuestionsTable">
                    <thead>
                        <tr>
                            <th>문항 번호</th>
                            <th>최대 정보량</th>
                            <th>변별도</th>
                            <th>난이도</th>
                            <th>평가영역</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 하위 문항 데이터 삽입 -->
                    </tbody>
                </table>

                <h3>4.2 구체적인 개선 전략 및 예시</h3>
                <ul>
                    <li>변별도 향상: 지문 명확화, 오답 매력도 증가</li>
                    <li>난이도 조정: 문제 난이도를 중간 수준으로 조정</li>
                    <li>문항 유형 변경: 객관식에서 단답형으로 변경 고려</li>
                    <li>지문 컨텍스트 개선: 실생활과 연관된 상황 제시</li>
                </ul>
            </div>

            <div class="section">
                <h2>5. 능력 수준별 문항 개발 가이드</h2>
                <h3>5.1 목표 능력 수준별 적정 난이도 및 변별도 범위</h3>
                <table>
                    <thead>
                        <tr>
                            <th>능력 수준</th>
                            <th>적정 난이도 범위</th>
                            <th>목표 변별도</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>하 (-2 ~ -1)</td>
                            <td>-2.5 ~ -0.5</td>
                            <td>0.8 이상</td>
                        </tr>
                        <tr>
                            <td>중하 (-1 ~ 0)</td>
                            <td>-1.5 ~ 0.5</td>
                            <td>1.0 이상</td>
                        </tr>
                        <tr>
                            <td>중상 (0 ~ 1)</td>
                            <td>-0.5 ~ 1.5</td>
                            <td>1.0 이상</td>
                        </tr>
                        <tr>
                            <td>상 (1 ~ 2)</td>
                            <td>0.5 ~ 2.5</td>
                            <td>0.8 이상</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5.2 정보 불균형 해소를 위한 문항 개발 전략</h3>
                <ul>
                    <li>고난도 문항 (난이도 > 1.5) 비율을 10% 이상으로 증가</li>
                    <li>
                        저난도 문항 (난이도 < -1.5) 비율을 10% 이상으로 유지
                    </li>
                    <li>각 능력 수준 구간에서 최소 5문항 이상 배치</li>
                    <li>구술시험 문항의 변별도를 평균 0.8 이상으로 개선</li>
                </ul>
            </div>

            <div class="section">
                <h2>6. 추가 시각화</h2>
                <h3>6.1 정보량-난이도-변별도 3D 산점도</h3>
                <div id="infoScatter3D"></div>
                <h3>6.2 개선 전후 정보 함수 비교</h3>
                <div class="chart-container">
                    <canvas id="improvementComparison"></canvas>
                </div>
            </div>
        </div>

        <footer>
            <p>
                본 프로파일은 2024년 9월 기준으로 작성되었습니다. 향후 시험 정책
                변경에 따라 내용이 수정될 수 있습니다.
            </p>
        </footer>
        <script type="module">
            import {
                df_questions as _df_questions,
                df_responses,
                df_questions_speaking as _df_questions_speaking,
                df_responses_speaking,
                speaking_grading_criteria,
            } from "./data2.js"

            const df_questions = _df_questions.map((q) => {
                q.난이도 = parseFloat(q.난이도)
                q.변별도 = parseFloat(q.변별도)
                return q
            })
            const df_questions_speaking = _df_questions_speaking.map((q) => {
                q.난이도 = parseFloat(q.난이도)
                q.변별도 = parseFloat(q.변별도)
                return q
            })

            function calculateItemInfo(alpha, beta) {
                return Math.pow(alpha, 2) / 4
            }

            const mergedData = [...df_questions, ...df_questions_speaking].map(
                (question) => {
                    const info = calculateItemInfo(
                        question.변별도,
                        question.난이도
                    )
                    return {
                        문제번호: question.문제번호,
                        평가영역: question.평가영역,
                        변별도: question.변별도,
                        난이도: question.난이도,
                        정보량: info,
                        문항유형: question.문항유형,
                    }
                }
            )

            const topQuestions = [...mergedData]
                .sort((a, b) => b.정보량 - a.정보량)
                .slice(0, 10)

            const bottomQuestions = [...mergedData]
                .sort((a, b) => a.정보량 - b.정보량)
                .slice(0, Math.ceil(mergedData.length * 0.1))

            const categoryInfo = {}
            mergedData.forEach((item) => {
                if (!categoryInfo[item.평가영역]) {
                    categoryInfo[item.평가영역] = { sum: 0, count: 0 }
                }
                categoryInfo[item.평가영역].sum += item.정보량
                categoryInfo[item.평가영역].count += 1
            })

            const avgInfoByCategory = Object.entries(categoryInfo).map(
                ([category, data]) => ({
                    category,
                    avg_info: +(data.sum / data.count).toFixed(3),
                })
            )

            // Update tables and charts
            function updateTables() {
                const topTableBody = document.querySelector(
                    "#topQuestionsTable tbody"
                )
                topTableBody.innerHTML = topQuestions
                    .map(
                        (item, index) => `
          <tr>
            <td>${index + 1}</td>
            <td>${item.문제번호}</td>
            <td>${item.정보량.toFixed(4)}</td>
            <td>${item.변별도.toFixed(4)}</td>
            <td>${item.난이도.toFixed(4)}</td>
            <td>${item.평가영역}</td>
          </tr>
        `
                    )
                    .join("")

                const bottomTableBody = document.querySelector(
                    "#bottomQuestionsTable tbody"
                )
                bottomTableBody.innerHTML = bottomQuestions
                    .map(
                        (item) => `
          <tr>
            <td>${item.문제번호}</td>
            <td>${item.정보량.toFixed(4)}</td>
            <td>${item.변별도.toFixed(4)}</td>
            <td>${item.난이도.toFixed(4)}</td>
            <td>${item.평가영역}</td>
          </tr>
        `
                    )
                    .join("")
            }

            function createCharts() {
                new Chart(document.getElementById("itemInfoScatter"), {
                    type: "scatter",
                    data: {
                        datasets: [
                            {
                                label: "필기문항",
                                data: mergedData
                                    .filter(
                                        (item) => item.문항유형 !== "구술형"
                                    )
                                    .map((item) => ({
                                        x: item.난이도,
                                        y: item.정보량,
                                        r: item.변별도 * 5,
                                        label: `문항 ${item.문제번호}`,
                                    })),
                                backgroundColor: "rgba(75, 192, 192, 0.6)",
                            },
                            {
                                label: "구술문항",
                                data: mergedData
                                    .filter(
                                        (item) => item.문항유형 === "구술형"
                                    )
                                    .map((item) => ({
                                        x: item.난이도,
                                        y: item.정보량,
                                        r: item.변별도 * 5,
                                        label: `문항 ${item.문제번호}`,
                                    })),
                                backgroundColor: "rgba(255, 99, 132, 0.6)",
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return `${
                                            context.raw.label
                                        }: 정보량=${context.raw.y.toFixed(
                                            4
                                        )}, 난이도=${context.raw.x.toFixed(2)}`
                                    },
                                },
                            },
                            title: {
                                display: true,
                                text: "문항별 최대 정보량 및 해당 능력 수준",
                            },
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: "난이도 (β)",
                                },
                                ticks: {
                                    callback: function (value) {
                                        return value.toFixed(2)
                                    },
                                },
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: "최대 정보량",
                                },
                                ticks: {
                                    callback: function (value) {
                                        return value.toFixed(2)
                                    },
                                },
                            },
                        },
                    },
                })

                new Chart(document.getElementById("avgInfoByCategory"), {
                    type: "bar",
                    data: {
                        labels: avgInfoByCategory.map((item) => item.category),
                        datasets: [
                            {
                                label: "평균 정보량",
                                data: avgInfoByCategory.map(
                                    (item) => item.avg_info
                                ),
                                backgroundColor: "rgba(75, 192, 192, 0.6)",
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: "평가영역별 평균 정보량",
                            },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "평균 정보량",
                                },
                                ticks: {
                                    callback: function (value) {
                                        return value.toFixed(2)
                                    },
                                },
                            },
                        },
                    },
                })
            }

            function updateAnalysis() {
                const avgDiscrimination =
                    topQuestions.reduce((sum, item) => sum + item.변별도, 0) /
                    topQuestions.length
                const avgDifficulty =
                    topQuestions.reduce((sum, item) => sum + item.난이도, 0) /
                    topQuestions.length
                const commonCategories = [
                    ...new Set(topQuestions.map((item) => item.평가영역)),
                ]

                document.querySelector("#highInfoCharacteristics").innerHTML = `
          <li>평균 변별도: ${avgDiscrimination.toFixed(2)}</li>
          <li>평균 난이도: ${avgDifficulty.toFixed(2)}</li>
          <li>주요 평가영역: ${commonCategories.join(", ")}</li>
        `

                const avgLowDiscrimination =
                    bottomQuestions.reduce(
                        (sum, item) => sum + item.변별도,
                        0
                    ) / bottomQuestions.length
                const avgLowDifficulty =
                    bottomQuestions.reduce(
                        (sum, item) => sum + item.난이도,
                        0
                    ) / bottomQuestions.length
                const lowInfoCategories = [
                    ...new Set(bottomQuestions.map((item) => item.평가영역)),
                ]

                document.querySelector("#lowInfoImprovement").innerHTML = `
          <li>변별도 향상: 현재 평균 ${avgLowDiscrimination.toFixed(
              2
          )}에서 ${avgDiscrimination.toFixed(2)} 이상으로 개선</li>
          <li>난이도 조정: 현재 평균 ${avgLowDifficulty.toFixed(
              2
          )}에서 ${avgDifficulty.toFixed(2)}에 가깝게 조정</li>
          <li>주요 개선 대상 평가영역: ${lowInfoCategories.join(", ")}</li>
        `
            }

            function create3DScatter() {
                const chart = echarts.init(
                    document.getElementById("infoScatter3D")
                )

                const option = {
                    tooltip: {},
                    xAxis3D: {
                        type: "value",
                        name: "난이도",
                        axisLabel: { formatter: "{value}" },
                    },
                    yAxis3D: {
                        type: "value",
                        name: "변별도",
                        axisLabel: { formatter: "{value}" },
                    },
                    zAxis3D: {
                        type: "value",
                        name: "정보량",
                        axisLabel: { formatter: "{value}" },
                    },
                    grid3D: {
                        viewControl: {
                            projection: "perspective", // 투시도를 유지
                            alpha: 5, // 회전 각도
                            beta: 40, // 기울기 각도
                            distance: 200, // 시야 거리, 차트 크기 조정
                            rotateSensitivity: [1, 1],
                            // rotateSensitivity: 0,  // 회전 비활성화
                            zoomSensitivity: 0,    // 확대/축소 비활성화
                            // panSensitivity: 0,     // 드래그 비활성화
                            // autoRotate: false,     // 자동 회전 비활성화
                        },
                        boxWidth: 150, // 차트의 가로 크기
                        boxHeight: 80, // 차트의 세로 크기
                        boxDepth: 100, // 차트의 깊이
                        top: '-10%',  // 상단 마진을 없애고, 차트를 더 위로 배치
                        light: {
                            main: {
                                intensity: 1.2,
                                shadow: true,
                            },
                        },
                    },
                    series: [
                        {
                            type: "scatter3D",
                            data: mergedData.map((item) => [
                                item.난이도,
                                item.변별도,
                                item.정보량,
                            ]),
                            symbolSize: 10, // 데이터 포인트 크기
                            itemStyle: {
                                color: function (params) {
                                    return `rgba(${Math.floor(
                                        255 * params.value[2]
                                    )}, 100, 150, 0.8)`
                                },
                            },
                            emphasis: {
                                label: {
                                    show: false,
                                },
                                itemStyle: {
                                    color: "rgba(255,0,0,1)",
                                    borderColor: "#fff",
                                    borderWidth: 2,
                                },
                            },
                        },
                    ],
                }
                chart.setOption(option)
            }

            function createImprovementComparison() {
                // 가상의 개선된 데이터 생성
                const improvedData = mergedData.map((item) => ({
                    ...item,
                    변별도: Math.min(item.변별도 * 1.2, 2), // 20% 증가, 최대 2
                    난이도: item.난이도 * 0.9, // 10% 감소
                }))

                const thetaRange = Array.from({ length: 61 }, (_, i) =>
                    (-3 + i * 0.1).toFixed(1)
                )

                const originalInfo = thetaRange.map((theta) =>
                    mergedData.reduce(
                        (sum, item) =>
                            sum + calculateItemInfo(item.변별도, item.난이도),
                        0
                    )
                )

                const improvedInfo = thetaRange.map((theta) =>
                    improvedData.reduce(
                        (sum, item) =>
                            sum + calculateItemInfo(item.변별도, item.난이도),
                        0
                    )
                )

                new Chart(document.getElementById("improvementComparison"), {
                    type: "line",
                    data: {
                        labels: thetaRange,
                        datasets: [
                            {
                                label: "개선 전",
                                data: originalInfo,
                                borderColor: "rgb(75, 192, 192)",
                                fill: false,
                            },
                            {
                                label: "개선 후",
                                data: improvedInfo,
                                borderColor: "rgb(255, 99, 132)",
                                fill: false,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: "개선 전후 정보 함수 비교",
                            },
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: "능력 수준 (θ)",
                                },
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: "정보량",
                                },
                            },
                        },
                    },
                })
            }
            document.addEventListener("DOMContentLoaded", () => {
                updateTables()
                createCharts()
                updateAnalysis()
                create3DScatter()
                createImprovementComparison()
            })
        </script>
    </body>
</html>
