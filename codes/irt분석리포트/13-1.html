<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>한국어능력시험 응시자 능력 분포 분석 보고서</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="report-styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>한국어능력시험 응시자 능력 분포 분석 보고서</h1>

      <div class="section">
        <h2>1. 요약</h2>
        <div id="summary"></div>
      </div>

      <div class="section">
        <h2>2. 능력 분포 상세 분석</h2>
        <div id="distribution-analysis"></div>
      </div>

      <div class="section">
        <h2>3. 집단별 분포 비교</h2>
        <div id="group-comparison"></div>
      </div>

      <div class="section">
        <h2>4. 시험 난이도 및 변별도 평가</h2>
        <div id="test-evaluation"></div>
      </div>

      <div class="section">
        <h2>5. 개선 권고사항</h2>
        <div id="recommendations"></div>
      </div>
    </div>

    <footer>
      <p>
        본 프로파일은 2024년 9월 기준으로 작성되었습니다. 향후 시험 정책 변경에
        따라 내용이 수정될 수 있습니다.
      </p>
    </footer>
    <script type="module">
      import {
        df_questions,
        df_responses,
        df_questions_speaking,
        df_responses_speaking,
        speaking_grading_criteria,
      } from "./data2.js";

      // 능력 추정치 배열 생성
      const abilities = df_responses.map((r) =>
        parseFloat(r["능력 추정치 (theta)"])
      );

      // 요약 통계 계산
      const mean = abilities.reduce((a, b) => a + b, 0) / abilities.length;
      const stdDev = Math.sqrt(
        abilities.reduce((a, b) => a + Math.pow(b - mean, 2), 0) /
          abilities.length
      );
      const median = abilities.sort((a, b) => a - b)[
        Math.floor(abilities.length / 2)
      ];

      // 요약 섹션 업데이트
      document.getElementById("summary").innerHTML = `
        <p>주요 분포 특성:</p>
        <ul>
          <li>평균: ${mean.toFixed(2)}</li>
          <li>표준편차: ${stdDev.toFixed(2)}</li>
          <li>중앙값: ${median.toFixed(2)}</li>
        </ul>
        <p>핵심 발견사항:</p>
        <ul>
          <li>응시자의 능력 분포는 대체로 정규 분포를 따르고 있습니다.</li>
          <li>능력 추정치의 범위는 약 -2.5에서 2.5 사이에 분포하고 있습니다.</li>
          <li>전체적인 난이도는 응시자 집단의 능력 수준에 적절히 맞춰져 있습니다.</li>
        </ul>
      `;

      // 히스토그램 생성
      const ctx = document.createElement("canvas");
      document.getElementById("distribution-analysis").appendChild(ctx);
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: [-3, -2, -1, 0, 1, 2, 3].map((v) => v.toString()),
          datasets: [
            {
              label: "빈도",
              data: [-3, -2, -1, 0, 1, 2, 3].map(
                (v) => abilities.filter((a) => a >= v && a < v + 1).length
              ),
              backgroundColor: "rgba(54, 162, 235, 0.5)",
              borderColor: "rgba(54, 162, 235, 1)",
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
          plugins: {
            title: {
              display: true,
              text: "능력 추정치 분포",
            },
          },
        },
      });

      // 집단별 분포 비교
      const groupComparison = document.getElementById("group-comparison");
      const nationalities = [...new Set(df_responses.map((r) => r.국적))];
      const nationalityData = nationalities.map((nat) => ({
        nationality: nat,
        mean:
          df_responses
            .filter((r) => r.국적 === nat)
            .reduce((a, b) => a + parseFloat(b["능력 추정치 (theta)"]), 0) /
          df_responses.filter((r) => r.국적 === nat).length,
      }));

      const ctx2 = document.createElement("canvas");
      groupComparison.appendChild(ctx2);
      new Chart(ctx2, {
        type: "bar",
        data: {
          labels: nationalityData.map((d) => d.nationality),
          datasets: [
            {
              label: "평균 능력 추정치",
              data: nationalityData.map((d) => d.mean),
              backgroundColor: "rgba(255, 99, 132, 0.5)",
              borderColor: "rgba(255, 99, 132, 1)",
              borderWidth: 1,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
          plugins: {
            title: {
              display: true,
              text: "국적별 평균 능력 추정치",
            },
          },
        },
      });

      // 시험 난이도 및 변별도 평가
      const testEvaluation = document.getElementById("test-evaluation");
      testEvaluation.innerHTML = `
        <p>문항 난이도 분포:</p>
        <ul>
          <li>최소 난이도: ${Math.min(
            ...df_questions.map((q) => q.난이도)
          ).toFixed(2)}</li>
          <li>최대 난이도: ${Math.max(
            ...df_questions.map((q) => q.난이도)
          ).toFixed(2)}</li>
          <li>평균 난이도: ${(
            df_questions.reduce((a, b) => a + b.난이도, 0) / df_questions.length
          ).toFixed(2)}</li>
        </ul>
        <p>변별도 분포:</p>
        <ul>
          <li>최소 변별도: ${Math.min(
            ...df_questions.map((q) => q.변별도)
          ).toFixed(2)}</li>
          <li>최대 변별도: ${Math.max(
            ...df_questions.map((q) => q.변별도)
          ).toFixed(2)}</li>
          <li>평균 변별도: ${(
            df_questions.reduce((a, b) => a + b.변별도, 0) / df_questions.length
          ).toFixed(2)}</li>
        </ul>
      `;

      // 개선 권고사항
      document.getElementById("recommendations").innerHTML = `
        <p>단기 개선 전략:</p>
        <ul>
          <li>극단적인 난이도를 가진 문항들을 검토하고 조정하여 전반적인 난이도 균형을 개선합니다.</li>
          <li>변별도가 낮은 문항들을 식별하고 개선하거나 대체합니다.</li>
        </ul>
        <p>장기 개선 전략:</p>
        <ul>
          <li>다양한 국적의 응시자들의 능력 차이를 고려한 맞춤형 문항 개발을 검토합니다.</li>
          <li>지속적인 문항 분석과 능력 분포 모니터링을 통해 시험의 품질을 유지 및 개선합니다.</li>
        </ul>
      `;
    </script>
  </body>
</html>
